<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Limbus Company Gacha Simulator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      text-align: center;
      padding: 20px;
    }
    
    .banners {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .banner {
      width: 200px;
      height: 80px;
      border: 2px solid #444;
      border-radius: 8px;
      cursor: pointer;
      background-size: cover;
      background-position: center;
      opacity: 0.9;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
      text-shadow: 1px 1px 3px #000;
      background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7));
    }
    
    .banner:hover {
      opacity: 1;
      transform: scale(1.05);
    }
    
    .banner.active {
      border-color: #ffe100;
      opacity: 1;
      transform: scale(1.05);
    }
    
    .results {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-top: 20px;
      justify-items: center;
    }
    
    .card {
      width: 200px;
      height: 260px;
      position: relative;
      overflow: hidden;
      border: 2px solid;
      display: flex;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s, transform 0.3s;
    }
    
    .card.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* Rectangular ID Cards */
    .card:not(.ego) {
      border-radius: 10px;
      background: var(--card-bg) center/cover no-repeat;
    }
    
    /* Circular EGO Cards */
    .card.ego {
      border-radius: 50%;
      width: 260px;
      height: 260px;
      background: var(--card-bg) center/cover no-repeat;
    }
    
    /* Rarity colors */
    .ego { border-color: #ffe100; }
    .triplezero { border-color: #fdf670; }
    .doublezero { border-color: #f10f05; }
    .common { border-color: #c09e5d; }
    
    .stats {
      margin-top: 20px;
      background: rgba(30,30,30,0.8);
      padding: 15px;
      border-radius: 8px;
      display: inline-block;
    }
    
    button {
      padding: 10px 20px;
      background-color: #444;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
      transition: background-color 0.3s;
    }
    
    button:hover {
      background-color: #666;
    }
  </style>
</head>
<body>
  <h1>Limbus Company Gacha Simulator</h1>
  
  <div class="banners">
    <div class="banner active" id="standardBanner" onclick="switchBanner('standard')" 
         style="background-image: url('Images/Standardbanner.png')">
         Standard Banner
    </div>
    <div class="banner" id="SuperBanner" onclick="switchBanner('Super')" 
         style="background-image: url('Images/superbanner.jpg')">
         Super Banner
    </div>
    <div class="banner" id="BokgakwalpurgisnightBanner" onclick="switchBanner('Bokgakwalpurgisnight')" 
         style="background-image: url('Images/1stand2ndBokgakwalpurgisnight.png')">
         1st + 2nd Bokgak Walpurgisnight
    </div>
    <div class="banner" id="6thWalpurgisnightBanner" onclick="switchBanner('6thWalpurgisnight')" 
         style="background-image: url('Images/6thWalpurgisnight.png')">
         6th Walpurgisnight
    </div>
  </div>

  <button onclick="drawTen()">Perform 10-Pull</button>
  <div class="results" id="results"></div>
  <div class="stats" id="stats"></div>

  <script>
    // Image mapping
    const imageMap = {
      // 3★ IDs
      "Ishmael [Seven South Section 6]": "img/ids/ishmael_3star.webp",
      "Gregor [LCCB Assistant Manager]": "img/ids/gregor_3star.webp",
      "Outis [R.B. Chef]": "img/ids/outis_3star.webp",
      
      // 2★ IDs
      "Rosespanner Workshop Fixer Gregor" : "Images/RosespannerGregor.png",
      "Liu Association South Section 6 Gregor" : "Images/LiuGregor.png",
      "R.B. Sous-Chef Gregor" : "Images/ChefGregor.png",
      "Kurokumo Clan Captain Gregor" : "Images/KurokumoGregor.png",
      "Blade Lineage Salsu Outis" : "Images/BLOutis.png",
      "G Corp Head Manager Outis" : "Images/GCorpOutis.png",
      "Cinq Association South Section 4 Outis" : "Images/CinqOutis.png",
      "The Ring Pointilist Student Outis" : "Images/RingOutis.png",
      "Zwei Association South Section 6 Sinclair" : "Images/ZweiSouthSinclair.png",
      "Los Mariachis Jefe Sinclair" : "Images/AidaSinclair.png",
      "Lobotomy E.G.O::Red Sheet Sinclair" : "Images/TalismanSinclair.png",
      "Molar Boatworks Fixer Sinclair" : "Images/MolarSinclair.png",
      "Zwei Association West Section 3 Sinclair" : "Images/ZweiWestSinclair.png",

      //1★ IDs
      "LCB Sinner Yi Sang": "Images/LCBYiSang.png",
      "LCB Sinner Faust": "Images/LCBFaust.png",
      "LCB Sinner Don Quixote": "Images/LCBDon.png",
      "LCB Sinner Ryōshū": "Images/LCBRyoshu.png",
      "LCB Sinner Meursault": "Images/LCBMeursault.png",
      "LCB Sinner Hong Lu": "Images/LCBHongLu.png",
      "LCB Sinner Ishmael": "Images/LCBIshmael.png",
      "LCB Sinner Heathcliff": "Images/LCBHeathcliff.png",
      "LCB Sinner Rodion": "Images/LCBRodya.png",
      "LCB Sinner Sinclair": "Images/LCBSinclair.png",
      "LCB Sinner Outis": "Images/LCBOutis.png",
      "LCB Sinner Gregor": "Images/LCBGregor.png",
      
      // EGOs
      "Ardor Blossom Star (Don Quixote)": "img/ego/ardor_blossom.webp",
      "Crow's Eye View (Ryōshū)": "img/ego/crows_eye.webp",
      "Spicebush (Faust)": "img/ego/spicebush.webp",
      "4th Match Flame (Ryōshū)": "img/ego/4th_match.webp",
      "Land of Illusion (Hong Lu)": "img/ego/land_of_illusion.webp",
      "Sunshower (Heathcliff)": "img/ego/sunshower.webp"
    };
    
    const FALLBACK_IMAGE = "img/default_card.webp";

    // Banner data
    const banners = {
      standard: {
        name: "Standard Banner",
        rates: { ego: 0.013, tripleZero: 0.029, doubleZero: 0.128, common: 0.83 },
        identities: {
          "3★": ["Ishmael [Seven South Section 6]", "Gregor [LCCB Assistant Manager]", "Outis [R.B. Chef]"],
          "2★": ["Rosespanner Workshop Fixer Gregor", "Liu Association South Section 6 Gregor", "Blade Lineage Salsu Outis",
                 "G Corp Head Manager Outis", "Cinq Association South Section 4 Outis", "The Ring Pointilist Student Outis",
                 "Zwei Association South Section 6 Sinclair", "Los Mariachis Jefe Sinclair", "Lobotomy E.G.O::Red Sheet Sinclair",
                 "Zwei Association West Section 3 Sinclair"],
          "1★": ["LCB Sinner Faust", "LCB Sinner Yi Sang", "LCB Sinner Don Quixote", "LCB Sinner Ryōshū", 
                 "LCB Sinner Outis", "LCB Sinner Ishmael", "LCB Sinner Heathcliff", "LCB Sinner Gregor", 
                 "LCB Sinner Hong Lu", "LCB Sinner Meursault", "LCB Sinner Rodion", "LCB Sinner Sinclair"]
        },
        egos: ["Ardor Blossom Star (Don Quixote)", "Crow's Eye View (Ryōshū)", "Spicebush (Faust)"]
      },
      "Super": {
        name: "Super Banner",
        rates: { ego: 0.01, tripleZero: 0.05, doubleZero: 0.14, common: 0.80 },
        identities: {
          "3★": ["Ishmael [The Pequod Captain]", "Rodion [R Corp. 4th Pack Rabbit]"],
          "2★": ["Rosespanner Workshop Fixer Gregor", "Liu Association South Section 6 Gregor", "Blade Lineage Salsu Outis",
                 "G Corp Head Manager Outis", "Cinq Association South Section 4 Outis", "The Ring Pointilist Student Outis",
                 "Zwei Association South Section 6 Sinclair", "Los Mariachis Jefe Sinclair", "Lobotomy E.G.O::Red Sheet Sinclair",
                 "Molar Boatworks Fixer Sinclair", "Zwei Association West Section 3 Sinclair"],
          "1★": ["LCB Sinner Faust", "LCB Sinner Yi Sang", "LCB Sinner Don Quixote", "LCB Sinner Ryōshū", 
                 "LCB Sinner Outis", "LCB Sinner Ishmael", "LCB Sinner Heathcliff", "LCB Sinner Gregor", 
                 "LCB Sinner Hong Lu", "LCB Sinner Meursault", "LCB Sinner Rodion", "LCB Sinner Sinclair"]
        },
        egos: ["4th Match Flame (Ryōshū)"]
      },
      "Bokgakwalpurgisnight": {
        name: "1st + 2nd Bokgak Walpurgisnight Targetted Extraction Banner",
        rates: { ego: 0.02, tripleZero: 0.03, doubleZero: 0.10, common: 0.85 },
        identities: {
          "3★": ["Faust [Pink Shoes]"],
          "2★": ["Sinclair [Blade Lineage Salsu]"],
          "1★": ["LCB Sinner Faust", "LCB Sinner Yi Sang", "LCB Sinner Don Quixote", "LCB Sinner Ryōshū", 
                 "LCB Sinner Outis", "LCB Sinner Ishmael", "LCB Sinner Heathcliff", "LCB Sinner Gregor", 
                 "LCB Sinner Hong Lu", "LCB Sinner Meursault", "LCB Sinner Rodion", "LCB Sinner Sinclair"]
        },
        egos: ["Land of Illusion (Hong Lu)", "Sunshower (Heathcliff)"]
      },
      "6thWalpurgisnight": {
        name: "6th Walpurgisnight Targetted Extraction Banner",
        rates: { ego: 0.02, tripleZero: 0.03, doubleZero: 0.10, common: 0.85 },
        identities: {
          "3★": ["Faust [Pink Shoes]"],
          "2★": ["Sinclair [Blade Lineage Salsu]"],
          "1★": ["LCB Sinner Faust", "LCB Sinner Yi Sang", "LCB Sinner Don Quixote", "LCB Sinner Ryōshū", 
                 "LCB Sinner Outis", "LCB Sinner Ishmael", "LCB Sinner Heathcliff", "LCB Sinner Gregor", 
                 "LCB Sinner Hong Lu", "LCB Sinner Meursault", "LCB Sinner Rodion", "LCB Sinner Sinclair"]
        },
        egos: ["Land of Illusion (Hong Lu)", "Sunshower (Heathcliff)"]
      }
    };

    let currentBanner = "standard";
    let state = {
      totalPulls: 0,
      ideality: 0,
      egoshards: 0
    };

    // Switch active banner
    function switchBanner(bannerKey) {
      currentBanner = bannerKey;
      document.querySelectorAll(".banner").forEach(b => b.classList.remove("active"));
      document.getElementById(`${bannerKey}Banner`).classList.add("active");
      updateStats();
    }

    function getRandomFrom(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function pullOnce() {
      const banner = banners[currentBanner];
      const roll = Math.random();
      
      if (roll < banner.rates.ego) {
        return { type: "EGO", name: getRandomFrom(banner.egos) };
      } else if (roll < banner.rates.ego + banner.rates.tripleZero) {
        return { type: "3★ ID", name: getRandomFrom(banner.identities["3★"]) };
      } else if (roll < banner.rates.ego + banner.rates.tripleZero + banner.rates.doubleZero) {
        return { type: "2★ ID", name: getRandomFrom(banner.identities["2★"]) };
      } else {
        return { type: "1★ ID", name: getRandomFrom(banner.identities["1★"]) };
      }
    }

    function createCard(pull) {
      const card = document.createElement('div');
      const isEGO = pull.type === "EGO";
      const rarityClass = isEGO ? "ego" :
                        pull.type === "3★ ID" ? "triplezero" :
                        pull.type === "2★ ID" ? "doublezero" : "common";
      
      card.className = `card ${rarityClass}`;
      card.style.setProperty('--card-bg', `url('${imageMap[pull.name] || FALLBACK_IMAGE}')`);
      
      return card;
    }

    async function drawTen() {
      const container = document.getElementById("results");
      container.innerHTML = "";
      const pulls = [];
      let guaranteed = false;
      const banner = banners[currentBanner];

      // Disable button during animation
      const pullButton = document.querySelector('button');
      pullButton.disabled = true;
      pullButton.textContent = "Drawing...";

      // Perform pulls
      for (let i = 0; i < 10; i++) {
        let result = pullOnce();
        state.totalPulls++;
        state.ideality++;

        if (result.type === "3★ ID") state.egoshards += 50;
        else if (result.type === "2★ ID") {
          state.egoshards += 15;
          guaranteed = true;
        } else if (result.type === "1★ ID") {
          state.egoshards += 3;
        } else if (result.type === "EGO") {
          state.egoshards += 30;
          guaranteed = true;
        }

        pulls.push(result);
      }

      // Apply guarantee if needed
      if (!guaranteed) {
        const replacement = pullOnceWhile(r => r.type !== "1★ ID");
        pulls[9] = replacement;
        state.egoshards -= 3;
        if (replacement.type === "3★ ID") state.egoshards += 50;
        else if (replacement.type === "2★ ID") state.egoshards += 15;
        else if (replacement.type === "EGO") state.egoshards += 30;
      }

      // Animate cards appearing one by one
      for (let i = 0; i < pulls.length; i++) {
        const card = createCard(pulls[i]);
        container.appendChild(card);
        
        // Trigger animation after a short delay
        setTimeout(() => {
          card.classList.add('show');
        }, i * 200); // 150ms delay between cards
        
        // Small delay to allow DOM updates
        await new Promise(resolve => setTimeout(resolve, 10));
      }

      // Re-enable button
      pullButton.disabled = false;
      pullButton.textContent = "Perform 10-Pull";
      
      updateStats();
    }

    function pullOnceWhile(conditionFn) {
      let result;
      do {
        result = pullOnce();
      } while (!conditionFn(result));
      return result;
    }

    function updateStats() {
      document.getElementById("stats").innerHTML = `
        <p><strong>Active Banner:</strong> ${banners[currentBanner].name}</p>
        <p><strong>Total Pulls:</strong> ${state.totalPulls}</p>
        <p><strong>Ideality:</strong> ${state.ideality}/200</p>
        <p><strong>Egoshards:</strong> ${state.egoshards}</p>
        <p><strong>Pity Status:</strong> ${state.ideality >= 200 ? "READY" : "Not yet"}</p>
      `;
    }

    // Preload images when page loads
    window.addEventListener('DOMContentLoaded', () => {
      const imagesToPreload = [
        ...Object.values(imageMap),
        FALLBACK_IMAGE,
        'Images/Standardbanner.png',
        'Images/superbanner.jpg',
        'Images/1stand2ndBokgakwalpurgisnight.png',
        'Images/6thWalpurgisnight.png'
      ];
      
      imagesToPreload.forEach(src => {
        new Image().src = src;
      });
    });
  </script>
</body>
</html>
