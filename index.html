<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Limbus Company Gacha Simulator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #eee;
      text-align: center;
      padding: 20px;
    }
    
    .banners {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .banner {
      width: 200px;
      height: 80px;
      border: 2px solid #444;
      border-radius: 8px;
      cursor: pointer;
      background-size: cover;
      background-position: center;
      opacity: 0.9;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
      text-shadow: 1px 1px 3px #000;
      background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7));
    }
    
    .banner:hover {
      opacity: 1;
      transform: scale(1.05);
    }
    
    .banner.active {
      border-color: #ffe100;
      opacity: 1;
      transform: scale(1.05);
    }
    
    .results {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-top: 20px;
      justify-items: center;
    }
    
    .card {
      width: 200px;
      height: 260px;
      position: relative;
      overflow: hidden;
      border: 2px solid;
      display: flex;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s, transform 0.3s;
    }
    
    .card.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .card:not(.ego) {
      border-radius: 10px;
      background: var(--card-bg) center/cover no-repeat;
    }
    
    .card.ego {
      border-radius: 50%;
      width: 260px;
      height: 260px;
      background: var(--card-bg) center/cover no-repeat;
    }
    
    .ego { border-color: #ffe100; }
    .triplezero { border-color: #fdf670; }
    .doublezero { border-color: #f10f05; }
    .common { border-color: #c09e5d; }
    
    .stats {
      margin-top: 20px;
      background: rgba(30,30,30,0.8);
      padding: 15px;
      border-radius: 8px;
      display: inline-block;
      margin-bottom: 20px;
    }
    
    .collection {
      background: rgba(30,30,30,0.8);
      padding: 15px;
      border-radius: 8px;
      margin: 20px auto;
      max-width: 800px;
      text-align: left;
    }
    
    .collection h3 {
      text-align: center;
      margin-top: 0;
    }
    
    .rarity-section {
      margin-bottom: 15px;
    }
    
    .rarity-title {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .identity-list {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .identity-item {
      background: rgba(0,100,0,0.5);
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .duplicate-count {
      font-size: 0.8em;
      color: #ccc;
      margin-left: 5px;
    }
    
    .shards-container {
      background: rgba(30,30,30,0.8);
      padding: 15px;
      border-radius: 8px;
      margin: 20px auto;
      max-width: 800px;
    }
    
    .shards-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    
    .shard-item {
      background: rgba(50,50,50,0.7);
      padding: 8px;
      border-radius: 5px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }
    
    .shard-icon {
      width: 50px;
      height: 50px;
      background-size: contain;
      background-position: center;
      background-repeat: no-repeat;
    }
    
    .shard-info {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .shard-count {
      font-weight: bold;
      font-size: 14px;
    }
    
    button {
      padding: 10px 20px;
      background-color: #444;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
      transition: background-color 0.3s;
    }
    
    button:hover {
      background-color: #666;
    }
  </style>
</head>
<body>
  <h1>Limbus Company Gacha Simulator</h1>
  
  <div class="banners">
    <div class="banner active" id="standardBanner" onclick="switchBanner('standard')" 
         style="background-image: url('Images/Standardbanner.png')">
    </div>
    <div class="banner" id="SuperBanner" onclick="switchBanner('Super')" 
         style="background-image: url('Images/superbanner.jpg')">
         Super Banner (every id and ego)
    </div>
    <div class="banner" id="BokgakwalpurgisnightBanner" onclick="switchBanner('Bokgakwalpurgisnight')" 
         style="background-image: url('Images/1stand2ndBokgakwalpurgisnight.png')">
    </div>
    <div class="banner" id="6thWalpurgisnightBanner" onclick="switchBanner('6thWalpurgisnight')" 
         style="background-image: url('Images/6thWalpurgisnight.png')">
    </div>
  </div>

  <button onclick="drawTen()">Perform 10-Pull</button>
  <div class="results" id="results"></div>
  <div class="stats" id="stats"></div>
  
  <div class="collection" id="collection">
    <h3>Acquired Identities</h3>
    <div class="rarity-section">
      <div class="rarity-title">3★ Identities</div>
      <div class="identity-list" id="triplezero-list"></div>
    </div>
    <div class="rarity-section">
      <div class="rarity-title">2★ Identities</div>
      <div class="identity-list" id="doublezero-list"></div>
    </div>
    <div class="rarity-section">
      <div class="rarity-title">1★ Identities</div>
      <div class="identity-list" id="common-list"></div>
    </div>
    <div class="rarity-section">
      <div class="rarity-title">EGOs</div>
      <div class="identity-list" id="ego-list"></div>
    </div>
  </div>

  <div class="shards-container" id="shards-container">
    <h3>Sinner Shards</h3>
    <div class="shards-grid" id="shards-grid"></div>
  </div>

  <script>
    // Image mapping
    const imageMap = {
      // 3★ IDs
      "PLACEHOLDER" : "Images/zenacat.png",
      "The Pequod Captain Ishmael": "Images/Ahabmael.png",
      
      // 2★ IDs
      "PLACEHOLDER" : "Images/zenacat.png",
      "Rosespanner Workshop Fixer Gregor": "Images/RosespannerGregor.png",
      "Liu Association South Section 6 Gregor": "Images/LiuGregor.png",
      "R.B. Sous-Chef Gregor": "Images/ChefGregor.png",
      "Kurokumo Clan Captain Gregor": "Images/KurokumoGregor.png",
      "Blade Lineage Salsu Outis": "Images/BLOutis.png",
      "G Corp Head Manager Outis": "Images/GCorpOutis.png",
      "Cinq Association South Section 4 Outis": "Images/CinqOutis.png",
      "The Ring Pointilist Student Outis": "Images/RingOutis.png",
      "Zwei Association South Section 6 Sinclair": "Images/ZweiSouthSinclair.png",
      "Los Mariachis Jefe Sinclair": "Images/AidaSinclair.png",
      "Lobotomy E.G.O::Red Sheet Sinclair": "Images/TalismanSinclair.png",
      "Molar Boatworks Fixer Sinclair": "Images/MolarSinclair.png",
      "Zwei Association West Section 3 Sinclair": "Images/ZweiWestSinclair.png",
      
      //1★ IDs
      "LCB Sinner Yi Sang": "Images/LCBYiSang.png",
      "LCB Sinner Faust": "Images/LCBFaust.png",
      "LCB Sinner Don Quixote": "Images/LCBDon.png",
      "LCB Sinner Ryoshu": "Images/LCBRyoshu.png",
      "LCB Sinner Meursault": "Images/LCBMeursault.png",
      "LCB Sinner Hong Lu": "Images/LCBHongLu.png",
      "LCB Sinner Ishmael": "Images/LCBIshmael.png",
      "LCB Sinner Heathcliff": "Images/LCBHeathcliff.png",
      "LCB Sinner Rodion": "Images/LCBRodya.png",
      "LCB Sinner Sinclair": "Images/LCBSinclair.png",
      "LCB Sinner Outis": "Images/LCBOutis.png",
      "LCB Sinner Gregor": "Images/LCBGregor.png",
      
      // EGOs
      "4th Match Flame (Ryoshu)": "Images/4thMatchFlameRyoshu.png",
      "PLACEHOLDER" : "Images/zenacat.png"
    };

    // Sinner icons
    const sinnerIcons = {
      "Yi Sang": "Images/YiSangIcon.png",
      "Faust": "Images/FaustIcon.png",
      "Don Quixote": "Images/DonQuixoteIcon.png",
      "Ryoshu": "Images/RyoshuIcon.png",
      "Meursault": "Images/MeursaultIcon.png",
      "Hong Lu": "Images/HongLuIcon.png",
      "Heathcliff": "Images/HeathcliffIcon.png",
      "Ishmael": "Images/IshmaelIcon.png",
      "Rodion": "Images/RodionIcon.png",
      "Sinclair": "Images/SinclairIcon.png",
      "Outis": "Images/OutisIcon.png",
      "Gregor": "Images/GregorIcon.png"
    };
    
    const FALLBACK_IMAGE = "img/default_card.webp";

    // Sinner names
    const sinners = [
      "Yi Sang", "Faust", "Don Quixote", "Ryoshu", 
      "Meursault", "Hong Lu", "Heathcliff", "Ishmael",
      "Rodion", "Sinclair", "Outis", "Gregor"
    ];

    // Banner data
    const banners = {
      standard: {
        name: "Standard Banner",
        rates: { ego: 0.013, tripleZero: 0.029, doubleZero: 0.128, common: 0.83 },
        identities: {
          "3★": ["PLACEHOLDER"],
          "2★": ["Rosespanner Workshop Fixer Gregor", "Liu Association South Section 6 Gregor", "Blade Lineage Salsu Outis",
                 "G Corp Head Manager Outis", "Cinq Association South Section 4 Outis", "The Ring Pointilist Student Outis",
                 "Zwei Association South Section 6 Sinclair", "Los Mariachis Jefe Sinclair", "Lobotomy E.G.O::Red Sheet Sinclair",
                 "Zwei Association West Section 3 Sinclair"],
          "1★": ["LCB Sinner Faust", "LCB Sinner Yi Sang", "LCB Sinner Don Quixote", "LCB Sinner Ryoshu", 
                 "LCB Sinner Outis", "LCB Sinner Ishmael", "LCB Sinner Heathcliff", "LCB Sinner Gregor", 
                 "LCB Sinner Hong Lu", "LCB Sinner Meursault", "LCB Sinner Rodion", "LCB Sinner Sinclair"]
        },
        egos: ["PLACEHOLDER"]
      },
      "Super": {
        name: "Super Banner",
        rates: { ego: 0.01, tripleZero: 0.05, doubleZero: 0.14, common: 0.80 },
        identities: {
          "3★": ["The Pequod Captain Ishmael"],
          "2★": ["Rosespanner Workshop Fixer Gregor", "Liu Association South Section 6 Gregor", "Blade Lineage Salsu Outis",
                 "G Corp Head Manager Outis", "Cinq Association South Section 4 Outis", "The Ring Pointilist Student Outis",
                 "Zwei Association South Section 6 Sinclair", "Los Mariachis Jefe Sinclair", "Lobotomy E.G.O::Red Sheet Sinclair",
                 "Molar Boatworks Fixer Sinclair", "Zwei Association West Section 3 Sinclair"],
          "1★": ["LCB Sinner Faust", "LCB Sinner Yi Sang", "LCB Sinner Don Quixote", "LCB Sinner Ryoshu", 
                 "LCB Sinner Outis", "LCB Sinner Ishmael", "LCB Sinner Heathcliff", "LCB Sinner Gregor", 
                 "LCB Sinner Hong Lu", "LCB Sinner Meursault", "LCB Sinner Rodion", "LCB Sinner Sinclair"]
        },
        egos: ["4th Match Flame (Ryoshu)"]
      },
      "Bokgakwalpurgisnight": {
        name: "1st + 2nd Bokgak Walpurgisnight Targetted Extraction Banner",
        rates: { ego: 0.02, tripleZero: 0.03, doubleZero: 0.10, common: 0.85 },
        identities: {
          "3★": ["PLACEHOLDER"],
          "2★": ["PLACEHOLDER"],
          "1★": ["LCB Sinner Faust", "LCB Sinner Yi Sang", "LCB Sinner Don Quixote", "LCB Sinner Ryoshu", 
                 "LCB Sinner Outis", "LCB Sinner Ishmael", "LCB Sinner Heathcliff", "LCB Sinner Gregor", 
                 "LCB Sinner Hong Lu", "LCB Sinner Meursault", "LCB Sinner Rodion", "LCB Sinner Sinclair"]
        },
        egos: ["PLACEHOLDER"]
      },
      "6thWalpurgisnight": {
        name: "6th Walpurgisnight Targetted Extraction Banner",
        rates: { ego: 0.02, tripleZero: 0.03, doubleZero: 0.10, common: 0.85 },
        identities: {
          "3★": ["PLACEHOLDER"],
          "2★": ["PLACEHOLDER"],
          "1★": ["LCB Sinner Faust", "LCB Sinner Yi Sang", "LCB Sinner Don Quixote", "LCB Sinner Ryoshu", 
                 "LCB Sinner Outis", "LCB Sinner Ishmael", "LCB Sinner Heathcliff", "LCB Sinner Gregor", 
                 "LCB Sinner Hong Lu", "LCB Sinner Meursault", "LCB Sinner Rodion", "LCB Sinner Sinclair"]
        },
        egos: ["PLACEHOLDER"]
      }
    };

    let currentBanner = "standard";
    let state = {
      totalPulls: 0,
      ideality: 0,
      collection: {
        "3★": new Map(),
        "2★": new Map(),
        "1★": new Map(),
        "EGO": new Map()
      },
      shards: {
        "Yi Sang": 0,
        "Faust": 0,
        "Don Quixote": 0,
        "Ryoshu": 0,
        "Meursault": 0,
        "Hong Lu": 0,
        "Heathcliff": 0,
        "Ishmael": 0,
        "Rodion": 0,
        "Sinclair": 0,
        "Outis": 0,
        "Gregor": 0
      }
    };

    // Switch active banner
    function switchBanner(bannerKey) {
      currentBanner = bannerKey;
      document.querySelectorAll(".banner").forEach(b => b.classList.remove("active"));
      document.getElementById(`${bannerKey}Banner`).classList.add("active");
      updateStats();
    }

    function getRandomFrom(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function pullOnce() {
      const banner = banners[currentBanner];
      const roll = Math.random();
      
      if (roll < banner.rates.ego) {
        return { type: "EGO", name: getRandomFrom(banner.egos) };
      } else if (roll < banner.rates.ego + banner.rates.tripleZero) {
        return { type: "3★ ID", name: getRandomFrom(banner.identities["3★"]) };
      } else if (roll < banner.rates.ego + banner.rates.tripleZero + banner.rates.doubleZero) {
        return { type: "2★ ID", name: getRandomFrom(banner.identities["2★"]) };
      } else {
        return { type: "1★ ID", name: getRandomFrom(banner.identities["1★"]) };
      }
    }

    function createCard(pull) {
      const card = document.createElement('div');
      const isEGO = pull.type === "EGO";
      const rarityClass = isEGO ? "ego" :
                        pull.type === "3★ ID" ? "triplezero" :
                        pull.type === "2★ ID" ? "doublezero" : "common";
      
      card.className = `card ${rarityClass}`;
      card.style.setProperty('--card-bg', `url('${imageMap[pull.name] || FALLBACK_IMAGE}')`);
      
      return card;
    }

    function getSinnerFromIdentity(identityName) {
      // Check if it's an EGO first
      if (identityName.includes("(Don Quixote)")) return "Don Quixote";
      if (identityName.includes("(Ryoshu)")) return "Ryoshu";
      if (identityName.includes("(Faust)")) return "Faust";
      if (identityName.includes("(Hong Lu)")) return "Hong Lu";
      if (identityName.includes("(Heathcliff)")) return "Heathcliff";
      
      // Then check for IDs
      for (const sinner of sinners) {
        if (identityName.includes(sinner)) {
          return sinner;
        }
      }
      return null;
    }

    function addToCollection(pull) {
      let collectionMap;
      if (pull.type === "EGO") {
        collectionMap = state.collection["EGO"];
      } else if (pull.type === "3★ ID") {
        collectionMap = state.collection["3★"];
      } else if (pull.type === "2★ ID") {
        collectionMap = state.collection["2★"];
      } else if (pull.type === "1★ ID") {
        collectionMap = state.collection["1★"];
      }

      // Increment count or add to collection
      const currentCount = collectionMap.get(pull.name) || 0;
      collectionMap.set(pull.name, currentCount + 1);
      
      // Add shards - all 1★ pulls count as duplicates (3 shards)
      // Other rarities only give shards on actual duplicates (count > 0)
      const sinner = getSinnerFromIdentity(pull.name);
      if (sinner && state.shards.hasOwnProperty(sinner)) {
        if (pull.type === "1★ ID") {
          // All 1★ pulls give shards (treated as duplicates)
          state.shards[sinner] += 3;
        } else if (currentCount > 0) {
          // Other rarities only give shards on duplicates
          if (pull.type === "3★ ID") {
            state.shards[sinner] += 50;
          } else if (pull.type === "2★ ID") {
            state.shards[sinner] += 15;
          } else if (pull.type === "EGO") {
            state.shards[sinner] += 30;
          }
        }
        updateShardsDisplay();
      }
      
      updateCollectionDisplay();
    }

    function updateCollectionDisplay() {
      // Update 3★ list
      const tripleZeroList = document.getElementById("triplezero-list");
      tripleZeroList.innerHTML = "";
      state.collection["3★"].forEach((count, id) => {
        const item = document.createElement('div');
        item.className = 'identity-item';
        item.textContent = id;
        if (count > 1) {
          const countSpan = document.createElement('span');
          countSpan.className = 'duplicate-count';
          countSpan.textContent = `x${count}`;
          item.appendChild(countSpan);
        }
        tripleZeroList.appendChild(item);
      });

      // Update 2★ list
      const doubleZeroList = document.getElementById("doublezero-list");
      doubleZeroList.innerHTML = "";
      state.collection["2★"].forEach((count, id) => {
        const item = document.createElement('div');
        item.className = 'identity-item';
        item.textContent = id;
        if (count > 1) {
          const countSpan = document.createElement('span');
          countSpan.className = 'duplicate-count';
          countSpan.textContent = `x${count}`;
          item.appendChild(countSpan);
        }
        doubleZeroList.appendChild(item);
      });

      // Update 1★ list
      const commonList = document.getElementById("common-list");
      commonList.innerHTML = "";
      state.collection["1★"].forEach((count, id) => {
        const item = document.createElement('div');
        item.className = 'identity-item';
        item.textContent = id;
        if (count > 1) {
          const countSpan = document.createElement('span');
          countSpan.className = 'duplicate-count';
          countSpan.textContent = `x${count}`;
          item.appendChild(countSpan);
        }
        commonList.appendChild(item);
      });

      // Update EGO list
      const egoList = document.getElementById("ego-list");
      egoList.innerHTML = "";
      state.collection["EGO"].forEach((count, ego) => {
        const item = document.createElement('div');
        item.className = 'identity-item';
        item.textContent = ego;
        if (count > 1) {
          const countSpan = document.createElement('span');
          countSpan.className = 'duplicate-count';
          countSpan.textContent = `x${count}`;
          item.appendChild(countSpan);
        }
        egoList.appendChild(item);
      });
    }

    function updateShardsDisplay() {
      const container = document.getElementById("shards-grid");
      container.innerHTML = "";
      
      // Add shard items for each sinner in 2 rows of 6
      sinners.forEach(sinner => {
        const shardItem = document.createElement('div');
        shardItem.className = 'shard-item';
        
        const icon = document.createElement('div');
        icon.className = 'shard-icon';
        icon.style.backgroundImage = `url('${sinnerIcons[sinner] || FALLBACK_IMAGE}')`;
        
        const nameSpan = document.createElement('span');
        nameSpan.textContent = sinner;
        
        const countSpan = document.createElement('span');
        countSpan.className = 'shard-count';
        countSpan.textContent = state.shards[sinner] || 0;
        
        shardItem.appendChild(icon);
        shardItem.appendChild(nameSpan);
        shardItem.appendChild(countSpan);
        
        container.appendChild(shardItem);
      });
    }

    async function drawTen() {
      const container = document.getElementById("results");
      container.innerHTML = "";
      const pulls = [];
      let guaranteed = false;
      const banner = banners[currentBanner];

      // Disable button during animation
      const pullButton = document.querySelector('button');
      pullButton.disabled = true;
      pullButton.textContent = "Drawing...";

      // Perform pulls
      for (let i = 0; i < 10; i++) {
        let result = pullOnce();
        state.totalPulls++;
        state.ideality++;

        if (result.type === "2★ ID" || result.type === "EGO") {
          guaranteed = true;
        }

        pulls.push(result);
        addToCollection(result);
      }

      // Apply guarantee if needed
      if (!guaranteed) {
        const replacement = pullOnceWhile(r => r.type !== "1★ ID");
        pulls[9] = replacement;
        addToCollection(replacement);
      }

      // Animate cards appearing one by one
      for (let i = 0; i < pulls.length; i++) {
        const card = createCard(pulls[i]);
        container.appendChild(card);
        
        // Trigger animation after a short delay
        setTimeout(() => {
          card.classList.add('show');
        }, i * 200);
        
        // Small delay to allow DOM updates
        await new Promise(resolve => setTimeout(resolve, 10));
      }

      // Re-enable button
      pullButton.disabled = false;
      pullButton.textContent = "Perform 10-Pull";
      
      updateStats();
    }

    function pullOnceWhile(conditionFn) {
      let result;
      do {
        result = pullOnce();
      } while (!conditionFn(result));
      return result;
    }

    function updateStats() {
      document.getElementById("stats").innerHTML = `
        <p><strong>Active Banner:</strong> ${banners[currentBanner].name}</p>
        <p><strong>Total Pulls:</strong> ${state.totalPulls}</p>
        <p><strong>Ideality:</strong> ${state.ideality}/200</p>
      `;
    }

    // Preload images when page loads
    window.addEventListener('DOMContentLoaded', () => {
      const imagesToPreload = [
        ...Object.values(imageMap),
        ...Object.values(sinnerIcons),
        FALLBACK_IMAGE,
        'Images/Standardbanner.png',
        'Images/superbanner.jpg',
        'Images/1stand2ndBokgakwalpurgisnight.png',
        'Images/6thWalpurgisnight.png'
      ];
      
      imagesToPreload.forEach(src => {
        new Image().src = src;
      });

      // Initialize displays
      updateCollectionDisplay();
      updateShardsDisplay();
    });
  </script>
</body>
</html>
